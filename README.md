## Репо с настройками для моей клавиатуры

### Прошивка

[Инструкция по сборке прошивки VIAL](https://get.vial.today/docs/porting-to-via.html)

[Репо исходников](https://github.com/X-Tips/QMK-Keyboard/tree/main/v4s)

После установки `qmk` и клонирования репозитория `vial-qmk` необходимо скопировать папку
`xtips` со всем содержимым в папку `/vial-qmk/keyboards/`

#### Команды для сборки и прошивки:

Перейти в папку `/vial-qmk/`
```sh
  cd ~/qmk-for-vial-dir/vial-qmk
```
Сборка прошивки
```sh
  make xtips/v4a:vial
```
Прошивка
```sh
  qmk flash -kb xtips/v4a -km vial
```
Добавить самоопределение половинке через EEPROM (если в прошивке используется EE_HANDS)
```sh
  qmk config set hand left
```
and right 

#### Порядок прошивки
- Сначала отключаем все кабели: 
  * основной кабель, который идет от компьютера
  * потом кабель, который между половинками от одной из половинок
- Потом подключаем к основному кабелю половинку зажав кнопку `I`/`E`, и прошиваем ее. Две половинки должны
  быть разъединены при этом
- (опционально) Добавить самоопределение половинке через EEPROM (если в прошивке используется EE_HANDS)
- После прошивки одной половинки, подключаем другую половинку к основному кабелю, который идет к компьютеру.
  Половинки должны быть разъединены при этом. Прошиваем другую половинку
- После прошивки другой половинки, вытаскиваем кабель и подключаем заново, если после прошивки клавиатура
  не вышла из режима прошивки
- Если в прошивке какая-то половинка жестко назначена master (MASTER_LEFT/MASTER_RIGHT), то сначала
  подключаем основной кабель к ней и только после этого соединяем половинки между собой

Для перехода в режим прошивки так же можно использовать клавишу на которую назначено `QK_BOOT` (через VIAL или qmk)

#### Способы определение половинок в прошивке (config.h)
1. ```
    #define SPLIT_USB_DETECT
    #define SPLIT_USB_TIMEOUT 5500
    #define SPLIT_USB_DETECT_TRIES 5
    #define SPLIT_USB_DETECT_DELAY 1000
   ```
   `SPLIT_USB_DETECT` - автоматически определяет ведущую половинку по тому куда приходит USB сигнал от компа. 
   На данный момент не работает при холодном старте, т.е. когда компьютер включается с уже подключенной 
   клавиатурой. Остальные настройки служат для откладывания определения половинок, что бы комп успел 
   "прогрузить" USB-порты после старта. <br>
   Попробовал разные варианты, ничего не помогло. Только перевоткнуть кабель после загрузки компа. На данный
   момент этот способ не рекомендуется.
2. ```
    #define MASTER_LEFT  // #define MASTER_RIGHT
   ``` 
   Жестко задать какая половинка ведущая. Подключать к компу всегда придется через неё, что не всегда может
   быть удобно.
3. ```
    #define EE_HANDS
   ```
   Позволяет после прошивки задать роль каждой половинке через ключ в EEPROM с помощью команды
   ```sh
    qmk config set hand left
   ```
   и `right`. <br>
   Используемый на данный момент способ.